<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monaco Editor Schema æµ‹è¯•</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1e1e1e;
      color: #fff;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .info {
      background: #2d2d30;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 3px solid #007acc;
    }

    .test-cases {
      background: #252526;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .test-case {
      margin-bottom: 15px;
      padding: 10px;
      background: #2d2d30;
      border-radius: 4px;
    }

    .test-case h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #4ec9b0;
    }

    .test-case pre {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 10px 0;
    }

    .expected {
      color: #4fc1ff;
      font-size: 14px;
    }

    #editor {
      height: 500px;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      margin-top: 20px;
    }

    .button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      font-size: 14px;
    }

    .button:hover {
      background: #1177bb;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      background: #2d2d30;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .success { color: #4ec9b0; }
    .error { color: #f48771; }
    .warning { color: #dcdcaa; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Monaco Editor JSON Schema æµ‹è¯•</h1>

  <div class="info">
    <strong>æµ‹è¯•ç›®çš„:</strong> éªŒè¯ vehicle_pack.meta.json çš„ JSON Schema éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ
    <br><br>
    <strong>ä½¿ç”¨æ–¹æ³•:</strong>
    <ol>
      <li>ç‚¹å‡»ä¸‹æ–¹çš„æµ‹è¯•æŒ‰é’®åŠ è½½ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹</li>
      <li>è§‚å¯Ÿç¼–è¾‘å™¨ä¸­æ˜¯å¦å‡ºç°çº¢è‰²æ³¢æµªçº¿ï¼ˆé”™è¯¯ï¼‰æˆ–é»„è‰²æ³¢æµªçº¿ï¼ˆè­¦å‘Šï¼‰</li>
      <li>é¼ æ ‡æ‚¬åœåœ¨æ³¢æµªçº¿ä¸ŠæŸ¥çœ‹é”™è¯¯ä¿¡æ¯</li>
      <li>æŒ‰ Ctrl+Space æµ‹è¯•æ™ºèƒ½æç¤ºæ˜¯å¦å·¥ä½œ</li>
    </ol>
  </div>

  <div class="test-cases">
    <h2>æµ‹è¯•ç”¨ä¾‹</h2>

    <div class="test-case">
      <h3>âœ… æµ‹è¯• 1: æ­£ç¡®çš„é…ç½®</h3>
      <button class="button" onclick="loadTest1()">åŠ è½½æµ‹è¯• 1</button>
      <div class="expected">é¢„æœŸ: æ— é”™è¯¯ï¼Œæ— è­¦å‘Š</div>
    </div>

    <div class="test-case">
      <h3>âŒ æµ‹è¯• 2: å‘½åç©ºé—´æ ¼å¼é”™è¯¯</h3>
      <button class="button" onclick="loadTest2()">åŠ è½½æµ‹è¯• 2</button>
      <div class="expected">é¢„æœŸ: namespace æœ‰çº¢è‰²æ³¢æµªçº¿ï¼Œæç¤º "String does not match pattern"</div>
    </div>

    <div class="test-case">
      <h3>âš ï¸ æµ‹è¯• 3: ç¼ºå°‘å¿…å¡«å­—æ®µ</h3>
      <button class="button" onclick="loadTest3()">åŠ è½½æµ‹è¯• 3</button>
      <div class="expected">é¢„æœŸ: é»„è‰²è­¦å‘Šï¼Œæç¤º "Missing required property 'namespace'"</div>
    </div>

    <div class="test-case">
      <h3>âŒ æµ‹è¯• 4: ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯</h3>
      <button class="button" onclick="loadTest4()">åŠ è½½æµ‹è¯• 4</button>
      <div class="expected">é¢„æœŸ: version æœ‰çº¢è‰²æ³¢æµªçº¿ï¼Œæç¤º "String does not match pattern"</div>
    </div>

    <div class="test-case">
      <h3>âŒ æµ‹è¯• 5: ç±»å‹é”™è¯¯</h3>
      <button class="button" onclick="loadTest5()">åŠ è½½æµ‹è¯• 5</button>
      <div class="expected">é¢„æœŸ: authors æœ‰çº¢è‰²æ³¢æµªçº¿ï¼Œæç¤º "Incorrect type. Expected 'array'"</div>
    </div>
  </div>

  <div id="editor"></div>

  <div class="status" id="status">
    <div>å‡†å¤‡å°±ç»ªã€‚ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æµ‹è¯•ç”¨ä¾‹ã€‚</div>
  </div>

  <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script>
    let editor;

    const vehiclePackMetaSchema = {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle Pack Metadata",
      "type": "object",
      "required": ["namespace"],
      "properties": {
        "namespace": {
          "type": "string",
          "pattern": "^[a-z0-9_]+$",
          "description": "è½½å…·åŒ…å‘½åç©ºé—´ï¼ˆä»…å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼‰"
        },
        "title": {
          "type": "string",
          "default": "unknown",
          "description": "è½½å…·åŒ…æ ‡é¢˜"
        },
        "description": {
          "type": "string",
          "default": "",
          "description": "è½½å…·åŒ…æè¿°"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "default": "1.0.0",
          "description": "ç‰ˆæœ¬å·ï¼ˆéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰"
        },
        "date": {
          "type": "string",
          "format": "date",
          "default": "2026-01-01",
          "description": "å‘å¸ƒæ—¥æœŸ"
        },
        "license": {
          "type": "string",
          "default": "All Rights Reserved",
          "description": "è®¸å¯è¯"
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "ä½œè€…åˆ—è¡¨"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "é¡¹ç›®ç½‘å€"
        },
        "dependencies": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "default": {},
          "description": "æ¨¡ç»„ä¾èµ–ï¼ˆæ¨¡ç»„ID: ç‰ˆæœ¬èŒƒå›´ï¼‰"
        }
      }
    };

    require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs' } });

    require(['vs/editor/editor.main'], function() {
      // é…ç½® JSON Schema
      monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
        validate: true,
        allowComments: true,
        schemas: [{
          uri: 'http://myserver/vehicle-pack-meta-schema.json',
          fileMatch: ['*vehicle_pack.meta.json'],
          schema: vehiclePackMetaSchema
        }]
      });

      updateStatus('success', 'Monaco Editor å·²åŠ è½½ï¼ŒSchema å·²é…ç½®');

      // åˆ›å»ºç¼–è¾‘å™¨
      const uri = monaco.Uri.parse('file:///vehicle_pack.meta.json');
      const model = monaco.editor.createModel('', 'json', uri);

      editor = monaco.editor.create(document.getElementById('editor'), {
        model: model,
        theme: 'vs-dark',
        fontSize: 14,
        minimap: { enabled: false },
        automaticLayout: true
      });

      // ç›‘å¬éªŒè¯å˜åŒ–
      monaco.editor.onDidChangeMarkers(([resource]) => {
        const markers = monaco.editor.getModelMarkers({ resource });
        if (markers.length > 0) {
          updateStatus('error', `æ£€æµ‹åˆ° ${markers.length} ä¸ªé—®é¢˜:\n` +
            markers.map(m => `  [${m.severity === 8 ? 'é”™è¯¯' : 'è­¦å‘Š'}] è¡Œ ${m.startLineNumber}: ${m.message}`).join('\n'));
        } else {
          updateStatus('success', 'âœ… æ— é”™è¯¯');
        }
      });

      loadTest1();
    });

    function updateStatus(type, message) {
      const status = document.getElementById('status');
      status.innerHTML = `<div class="${type}">${message.replace(/\n/g, '<br>')}</div>`;
    }

    function loadTest1() {
      const code = `{
  "namespace": "my_vehicle_pack",
  "title": "æˆ‘çš„è½½å…·åŒ…",
  "description": "ä¸€ä¸ªç¤ºä¾‹è½½å…·åŒ…",
  "version": "1.0.0",
  "date": "2026-01-30",
  "license": "MIT",
  "authors": ["å¼ ä¸‰", "æå››"],
  "url": "https://example.com",
  "dependencies": {
    "ywzj_vehicle": "[0.0.1,)"
  }
}`;
      editor.setValue(code);
      updateStatus('warning', 'æµ‹è¯• 1 å·²åŠ è½½ï¼Œç­‰å¾…éªŒè¯...');
    }

    function loadTest2() {
      const code = `{
  "namespace": "My-Vehicle-Pack",
  "title": "é”™è¯¯çš„å‘½åç©ºé—´"
}`;
      editor.setValue(code);
      updateStatus('warning', 'æµ‹è¯• 2 å·²åŠ è½½ï¼Œåº”è¯¥çœ‹åˆ° namespace çš„é”™è¯¯...');
    }

    function loadTest3() {
      const code = `{
  "title": "ç¼ºå°‘ namespace",
  "version": "1.0.0"
}`;
      editor.setValue(code);
      updateStatus('warning', 'æµ‹è¯• 3 å·²åŠ è½½ï¼Œåº”è¯¥çœ‹åˆ°ç¼ºå°‘å¿…å¡«å­—æ®µçš„è­¦å‘Š...');
    }

    function loadTest4() {
      const code = `{
  "namespace": "test_pack",
  "version": "1.0"
}`;
      editor.setValue(code);
      updateStatus('warning', 'æµ‹è¯• 4 å·²åŠ è½½ï¼Œåº”è¯¥çœ‹åˆ° version çš„é”™è¯¯...');
    }

    function loadTest5() {
      const code = `{
  "namespace": "test_pack",
  "authors": "åº”è¯¥æ˜¯æ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²"
}`;
      editor.setValue(code);
      updateStatus('warning', 'æµ‹è¯• 5 å·²åŠ è½½ï¼Œåº”è¯¥çœ‹åˆ° authors çš„ç±»å‹é”™è¯¯...');
    }
  </script>
</body>
</html>
