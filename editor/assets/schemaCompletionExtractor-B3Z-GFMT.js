function c(e,r){const t=r["x-completion"];if(!t||!t.packType||!t.category)return null;const o={fieldPattern:e,packType:t.packType,category:t.category,description:r.description||`${e} 字段`,priority:t.priority||10};return console.log(`[SchemaExtractor] 从属性 "${e}" 提取规则:`,o),o}function s(e,r=[]){const t=[];if(!e||typeof e!="object")return t;if(e.properties&&typeof e.properties=="object")for(const[o,i]of Object.entries(e.properties)){const n=c(o,i);if(n&&t.push(n),typeof i=="object"&&i!==null){const p=s(i,[...r,o]);t.push(...p)}}if(e.additionalProperties&&typeof e.additionalProperties=="object"){const o=e.additionalProperties["x-completion"];o&&t.push({fieldPattern:/.*/,packType:o.packType,category:o.category,description:e.additionalProperties.description||"动态属性",priority:o.priority||5})}if(e.items&&typeof e.items=="object"){const o=s(e.items,[...r,"items"]);t.push(...o)}for(const o of["anyOf","oneOf","allOf"])if(Array.isArray(e[o]))for(const i of e[o]){const n=s(i,r);t.push(...n)}return t}function l(e){const r=[];for(const t of e){const o=s(t);r.push(...o)}return r}function f(e){const r=e.map(t=>t.schema);return l(r)}function u(e){const r=new Map;for(const t of e){const o=`${typeof t.fieldPattern=="string"?t.fieldPattern:t.fieldPattern.source}:${t.packType}:${t.category}`;if(r.has(o)){const i=r.get(o);(t.priority||0)>(i.priority||0)&&r.set(o,t)}else r.set(o,t)}return Array.from(r.values())}export{u as deduplicateCompletionRules,c as extractCompletionFromProperty,s as extractCompletionRulesFromSchema,f as extractCompletionRulesFromSchemaRegistry,l as extractCompletionRulesFromSchemas};
